"use strict";angular.module("OxApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","notificationModule","cardflipModule","fullscreenModule","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/session/login.html",controller:"LoginCtrl",bodyStyle:{"background-color":"green"}}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/pipeline/dashboard",{templateUrl:"views/pipeline/dashboard.html",controller:"DashboardCtrl"}).when("/pipeline/grid/:projectId",{templateUrl:"views/pipeline/grid.html",controller:"GridCtrl"}).when("/layout/navbar",{templateUrl:"views/layout/navbar.html",controller:"NavbarCtrl"}).otherwise({redirectTo:"/login"})}]),angular.module("OxApp").controller("MainCtrl",["$scope",function(){}]),angular.module("OxApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("OxApp").service("ApiUtils",["$http",function(a){a.defaults.headers.common.Authorization="Bearer accessToken";var b="http://172.17.201.94:9091/Ox-Server/me",c=5e3,d={};this.getServerURL=function(){return b},this.buildQueryParam=function(a){var b,c;if(!(a&&a instanceof Object))throw"ApiUtils.buildQueryParam: expected params as Json";c="?";for(b in a)c+="&"+b+"="+a[b];return"?"==c?"":c=c.replace("?&","?")},this.get=function(b,c,d){a.get(b).then(function(a){console.log(""),c(a)},function(a){console.log(""),d(a)})},this.post=function(b,c,d,e){a.post(b,c).then(function(a){console.log(""),d(a)},function(a){console.log(""),e(a)})},this.put=function(){},this.delete=function(){},this.startPolling=function(b,e,f){if(!d[b]){var g=function(){a.get(e).then(f)};g(),d[b]=setInterval(g,c)}},this.stopPolling=function(a){clearInterval(d[a]),delete d[a]}}]),angular.module("OxApp").controller("LoginCtrl",["$scope","$location",function(a,b){a.logged=function(){b.path("/pipeline/dashboard")}}]),angular.module("OxApp").controller("DashboardCtrl",["$scope","$modal","Project","Stage","NotificationAPI","$location",function(a,b,c,d,e,f){a.projects=[],c.stopPolling("getProjects"),a.open=function(){b.open({templateUrl:"myModalContent.html",controller:j})},a.showGrid=function(a){f.path("/pipeline/grid/"+a)};var g=function(b){a.projects=b.data},h=function(a){console.log("Error: "+a)},i=function(){e.showNotification("El proyecto a comenzado a correr.")};a.delete=function(a){b.open({templateUrl:"confirmModal.html",controller:k,resolve:{project:function(){return a}}})},a.runs=function(a){c.runsProject(a,i,h)};var j=["$scope","$modalInstance",function(a,b){a.project={};var g=function(a){var b=a.split("/");return b[b.length-1]},i=function(){e.showNotification("Se ha creado el proyecto con exito."),f.path("/pipeline/grid/"+a.project.id),b.close()},j=function(b){var c={type:"commit-stage",url:a.project.url,branch:a.project.branch},e=g(b.headers("Location"));a.project.id=e,d.setStage(e,c,i,h)};a.createProject=function(d){a.project=d;var e={name:d.name,description:d.description};c.saveProject(e,j,h),b.close()},a.cancel=function(){b.dismiss("cancel")}}],k=["$scope","$modalInstance","project",function(a,b,d){a.project=d;var f=function(){e.showNotification("Se ha eliminado el proyecto con exito.")};a.deleteConfirmed=function(a){c.deleteProject(a,f,h)},a.cancel=function(){b.dismiss("cancel")}}];c.getProjects(g,h)}]),angular.module("OxApp").service("ApiProject",["$http","ApiUtils",function(a,b){var c=b.getServerURL();this.getProjects=function(a){b.startPolling("getProjects",c+"/projects",a)},this.saveProject=function(b,d,e){a.post(c+"/projects",b).then(function(a){d(a)},function(a){e(a)})},this.deleteProject=function(b,d,e){var f="/projects/"+b;a.delete(c+f).then(function(a){d(a)},function(a){e(a)})},this.runsProject=function(b,d,e){var f="/projects/"+b+"/runs";a.post(c+f).then(function(a){d(a)},function(a){e(a)})},this.stopPolling=function(a){b.stopPolling(a)}}]),angular.module("OxApp").service("Project",["ApiProject",function(a){var b=function(a){console.log("Error:"+a)};this.getProjects=function(c){var d=function(a){c(a)};a.getProjects(d,b)},this.saveProject=function(c,d){var e=function(a){d(a)};a.saveProject(c,e,b)},this.deleteProject=function(c,d){var e=function(a){d(a)};a.deleteProject(c,e,b)},this.runsProject=function(c,d){var e=function(a){d(a)};a.runsProject(c,e,b)},this.stopPolling=function(b){a.stopPolling(b)}}]),angular.module("OxApp").service("Stage",["ApiStage",function(a){var b=function(a){console.log("Error:"+a)};this.setStage=function(c,d,e){var f=function(a){e(a)};a.setStage(c,d,f,b)},this.getStages=function(c,d){var e=function(a){d(a)};a.getStages(c,e,b)},this.deleteStage=function(c,d,e){var f=function(a){e(a)};a.deleteStage(c,d,f,b)},this.runsStage=function(c,d,e){var f=function(a){e(a)};a.runsStage(c,d,f,b)},this.stopPolling=function(b){a.stopPolling(b)}}]),angular.module("OxApp").service("ApiStage",["$http","ApiUtils",function(a,b){var c=b.getServerURL();this.setStage=function(b,d,e,f){var g="/projects/"+b+"/stages";a.post(c+g,d).then(function(a){e(a)},function(a){f(a)})},this.getStages=function(a,d){var e="/projects/"+a+"/stages";b.startPolling("getStages",c+e,d)},this.deleteStage=function(b,d,e,f){var g="/projects/"+b+"/stages/"+d;a.delete(c+g).then(function(a){e(a)},function(a){f(a)})},this.runsStage=function(b,d,e,f){var g="/projects/"+b+"/stages/"+d+"/runs";a.post(c+g).then(function(a){e(a)},function(a){f(a)})},this.stopPolling=function(a){b.stopPolling(a)}}]),function(a,b){b.module("notificationModule",[]).controller("NotificationController",["$scope","NotificationAPI",function(a,b){a.api=b}]).factory("NotificationAPI",function(){return{status:!1,message:"",showNotification:function(a){this.status=!0,this.message=a},clear:function(){this.status=!1}}}).directive("notification",["$timeout","$animate",function(a,b){return{restrict:"E",replace:!0,controller:"NotificationController",template:'<div class="alert alert-success" role="alert" ng-show="api.status"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>{{api.message}}</div>',link:function(c,d,e){c.$watch(e.ngShow,function(e){e&&a(function(){c.api.status=!1,b.removeClass(d,"ng-hide")},5e3)})}}}])}(window,window.angular),function(a,b){b.module("cardflipModule",[]).directive("cardflip",[function(){return{restrict:"AE",replace:!0,transclude:!0,scope:{flipped:"=?"},template:'<div class="flip"><div class="card" ng-transclude></div></div>',controller:["$scope","$element",function(a,b){this.toggle=function(){var c=!b.hasClass("flipped");a.$apply(function(){a.flipped=c})},this.cardFront=function(){a.flipped=!1},this.cardBack=function(){a.flipped=!0}}],link:function(a,b){a.$watch("flipped",function(a){a?b.addClass("flipped"):b.removeClass("flipped")})}}}]).directive("cardFront",[function(){return{require:"^cardflip",restrict:"E",replace:!0,transclude:!0,template:'<div class="face front" ng-transclude></div>'}}]).directive("cardBack",[function(){return{require:"^cardflip",restrict:"E",replace:!0,transclude:!0,template:'<div class="face back" ng-transclude></div>'}}]).directive("cardToggle",[function(){return{require:"^cardflip",restrict:"A",link:function(a,b,c,d){var e;c.$observe("cardToggle",function(a){a||(a="click"),e&&b.off(e,d.toggle),e=a,b.on(a,d.toggle)})}}}]).directive("cardHeader",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-header" ng-transclude></div>'}}]).directive("cardBody",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-body" ng-transclude></div>'}}]).directive("cardFooter",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-footer" ng-transclude></div>'}}])}(window,window.angular),function(a,b,c){b.module("fullscreenModule",[]).factory("Fullscreen",["$document","$rootScope",function(a,c){var d=a[0],e="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element&&Element.ALLOW_KEYBOARD_INPUT,f=c.$new();a.on("fullscreenchange webkitfullscreenchange mozfullscreenchange MSFullscreenChange",function(){f.$emit("FBFullscreen.change",g.isEnabled())});var g={$on:b.bind(f,f.$on),all:function(){g.enable(d.documentElement)},enable:function(a){a.requestFullScreen?a.requestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?/Version\/[\d]{1,2}(\.[\d]{1,2}){1}(\.(\d){1,2}){0,1} Safari/.test(navigator.userAgent)?a.webkitRequestFullscreen():a.webkitRequestFullscreen(e):a.msRequestFullscreen&&a.msRequestFullscreen()},cancel:function(){d.cancelFullScreen?d.cancelFullScreen():d.mozCancelFullScreen?d.mozCancelFullScreen():d.webkitExitFullscreen?d.webkitExitFullscreen():d.msExitFullscreen&&d.msExitFullscreen()},isEnabled:function(){var a=d.fullscreenElement||d.mozFullScreenElement||d.webkitFullscreenElement||d.msFullscreenElement;return a?!0:!1},toggleAll:function(){g.isEnabled()?g.cancel():g.all()},isSupported:function(){var a=d.documentElement,b=a.requestFullScreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen;return b?!0:!1}};return g}]).directive("fullscreen",["Fullscreen",function(a){return{link:function(b,d,e){if(e.fullscreen){b.$watch(e.fullscreen,function(b){var c=a.isEnabled();b&&!c?(a.enable(d[0]),d.addClass("isInFullScreen")):!b&&c&&(a.cancel(),d.removeClass("isInFullScreen"))});var f=a.$on("FBFullscreen.change",function(a,c){c||b.$evalAsync(function(){b.$eval(e.fullscreen+"= false"),d.removeClass("isInFullScreen")})});b.$on("$destroy",function(){f()})}else{if(e.onlyWatchedProperty!==c)return;d.on("click",function(){a.enable(d[0])})}}}}])}(window,window.angular),angular.module("OxApp").controller("GridCtrl",["$scope","$routeParams","NotificationAPI","$location","$modal","Stage",function(a,b,c,d,e,f){a.jobs=[],a.stages={},a.rowPosition=0,a.maxCol=0;var g=12;f.stopPolling("getStages"),a.createModal=function(){e.open({templateUrl:"createStageModal.html",controller:n,resolve:{stages:function(){return a.stages}}})},a.getRows=function(a){return new Array(a)},a.getCols=function(a){return new Array(a)},a.isEmpty=function(a){return angular.equals({},a)},a.getJobInGrid=function(b,c){for(var d=0;d<a.jobs.length;d++)if(a.jobs[d].rowPosition==b&&a.jobs[d].colPosition==c)return a.jobs[d];return null},a.delete=function(a){e.open({templateUrl:"confirmModal.html",controller:o,resolve:{stage:function(){return a}}})};var h=function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c].colPosition;d>b&&(b=d)}return d},i=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];return null},j=function(b,c,d){var e=c.next;if(null!=e){var f=c;f.rowPosition=a.rowPosition,f.colPosition=d,a.jobs.push(f),d++;for(var g=0;g<e.length;g++){var h=i(b,e[g]);0!=g&&a.rowPosition++,j(b,h,d)}}},k=function(b){a.stages=b.data,j(b.data,b.data[0],0),a.maxCol=h(a.jobs),a.colDivision=Math.floor(g/(a.maxCol+1))},l=function(a){console.log("Error: "+a)},m=function(){c.showNotification("El stage a comenzado a correr.")};a.runs=function(a){f.runsStage(b.projectId,a,m,l)},f.getStages(b.projectId,k,l);var n=["$scope","$modalInstance","stages",function(a,d,e){a.stages=e;var g=function(){c.showNotification("Se ha creado el stage con exito.")};a.addStage=function(a){f.setStage(b.projectId,a,g,l)},a.close=function(){d.dismiss("cancel")}}],o=["$scope","$modalInstance","stage",function(a,d,e){a.stage=e;var g=function(){c.showNotification("Se ha eliminado el stage con exito.")};a.deleteConfirmed=function(a){f.deleteStage(b.projectId,a,g,l)},a.cancel=function(){d.dismiss("cancel")}}]}]),angular.module("OxApp").controller("NavbarCtrl",["$scope","$location","Fullscreen",function(a,b,c){a.isActive=function(c){return a.$parent.myStyle="/login"==b.path()?{background:"#0B3F41"}:{background:"#efefef"},c===b.path()},a.goFullscreen=function(){c.isEnabled()?c.cancel():c.all()}}]);
"use strict";angular.module("OxApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","notificationModule","cardflipModule","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/session/login.html",controller:"LoginCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/pipeline/dashboard",{templateUrl:"views/pipeline/dashboard.html",controller:"DashboardCtrl"}).when("/pipeline/grid/:projectId",{templateUrl:"views/pipeline/grid.html",controller:"GridCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("OxApp").controller("MainCtrl",["$scope",function(){}]),angular.module("OxApp").controller("AboutCtrl",["$scope",function(){}]),angular.module("OxApp").service("ApiUtils",["$http",function(a){a.defaults.headers.common.Authorization="Bearer accessToken";var b="http://172.17.201.94:9091/Ox-Server/me";this.getServerURL=function(){return b},this.buildQueryParam=function(a){var b,c;if(!(a&&a instanceof Object))throw"ApiUtils.buildQueryParam: expected params as Json";c="?";for(b in a)c+="&"+b+"="+a[b];return"?"==c?"":c=c.replace("?&","?")},this.get=function(b,c,d){a.get(b).then(function(a){console.log(""),c(a)},function(a){console.log(""),d(a)})},this.post=function(b,c,d,e){a.post(b,c).then(function(a){console.log(""),d(a)},function(a){console.log(""),e(a)})},this.put=function(){},this.delete=function(){}}]),angular.module("OxApp").controller("LoginCtrl",["$scope","$location",function(a,b){a.logged=function(){b.path("/pipeline/dashboard")}}]),angular.module("OxApp").controller("DashboardCtrl",["$scope","$modal","Project","Stage","NotificationAPI","$location",function(a,b,c,d,e,f){a.projects=[],a.open=function(){b.open({templateUrl:"myModalContent.html",controller:j})},a.showGrid=function(a){f.path("/pipeline/grid/"+a)};var g=function(b){a.projects=b.data},h=function(a){console.log("Error: "+a)},i=function(){e.showNotification("Se ha eliminado el proyecto con exito.")};a.delete=function(a){c.deleteProject(a,i,h)},a.run=function(a){c.saveProject(a,i,h)};var j=["$scope","$modalInstance",function(a,b){a.project={};var g=function(a){var b=a.split("/");return b[b.length-1]},i=function(){e.showNotification("Se ha creado el proyecto con exito."),f.path("/pipeline/grid/"+a.project.id),b.close()},j=function(b){var c={type:"commit-stage",url:a.project.url,branch:a.project.branch},e=g(b.headers("Location"));a.project.id=e,d.setStage(e,c,i,h)};a.createProject=function(d){a.project=d;var e={name:d.name,description:d.description};c.saveProject(e,j,h),b.close()},a.cancel=function(){b.dismiss("cancel")}}];c.getProjects(g,h)}]),angular.module("OxApp").service("ApiProject",["$http","$location","ApiUtils",function(a,b,c){var d=c.getServerURL();this.getProjects=function(b,c){a.get(d+"/projects").then(function(a){console.log(""),b(a)},function(a){console.log(""),c(a)})},this.saveProject=function(b,c,e){a.post(d+"/projects",b).then(function(a){console.log(""),c(a)},function(a){console.log(""),e(a)})},this.deleteProject=function(b,c,e){a.delete(d+"/projects/"+b).then(function(a){console.log(""),c(a)},function(a){console.log(""),e(a)})},this.runProject=function(b,c,e){a.post(d+"/projects/"+b+"/run").then(function(a){console.log(""),c(a)},function(a){console.log(""),e(a)})}}]),angular.module("OxApp").service("Project",["ApiProject",function(a){var b=function(a){console.log("Error:"+a)};this.getProjects=function(c){var d=function(a){c(a)};a.getProjects(d,b)},this.saveProject=function(c,d){var e=function(a){d(a)};a.saveProject(c,e,b)},this.deleteProject=function(c,d){var e=function(a){d(a)};a.deleteProject(c,e,b)},this.runProject=function(c,d){var e=function(a){d(a)};a.runProject(c,e,b)}}]),angular.module("OxApp").service("Stage",["ApiStage",function(a){var b=function(a){console.log("Error:"+a)};this.setStage=function(c,d,e){var f=function(a){e(a)};a.setStage(c,d,f,b)},this.getStages=function(c,d){var e=function(a){d(a)};a.getStages(c,e,b)}}]),angular.module("OxApp").service("ApiStage",["$http","$location","ApiUtils",function(a,b,c){var d=c.getServerURL();this.setStage=function(b,c,e,f){a.post(d+"/projects/"+b+"/stages",c).then(function(a){console.log(""),e(a)},function(a){console.log(""),f(a)})},this.getStages=function(b,c,e){a.get(d+"/projects/"+b+"/stages").then(function(a){console.log(""),c(a)},function(a){console.log(""),e(a)})}}]),function(a,b){b.module("notificationModule",[]).controller("NotificationController",["$scope","NotificationAPI",function(a,b){a.api=b}]).factory("NotificationAPI",function(){return{status:!1,message:"",showNotification:function(a){this.status=!0,this.message=a},clear:function(){this.status=!1}}}).directive("notification",["$timeout","$animate",function(a,b){return{restrict:"E",replace:!0,controller:"NotificationController",template:'<div class="alert alert-success" role="alert" ng-show="api.status"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>{{api.message}}</div>',link:function(c,d,e){c.$watch(e.ngShow,function(e){e&&a(function(){c.api.status=!1,b.removeClass(d,"ng-hide")},5e3)})}}}])}(window,window.angular),function(a,b){b.module("cardflipModule",[]).directive("cardflip",[function(){return{restrict:"AE",replace:!0,transclude:!0,scope:{flipped:"=?"},template:'<div class="flip"><div class="card" ng-transclude></div></div>',controller:["$scope","$element",function(a,b){this.toggle=function(){var c=!b.hasClass("flipped");a.$apply(function(){a.flipped=c})},this.cardFront=function(){a.flipped=!1},this.cardBack=function(){a.flipped=!0}}],link:function(a,b){a.$watch("flipped",function(a){a?b.addClass("flipped"):b.removeClass("flipped")})}}}]).directive("cardFront",[function(){return{require:"^cardflip",restrict:"E",replace:!0,transclude:!0,template:'<div class="face front" ng-transclude></div>'}}]).directive("cardBack",[function(){return{require:"^cardflip",restrict:"E",replace:!0,transclude:!0,template:'<div class="face back" ng-transclude></div>'}}]).directive("cardToggle",[function(){return{require:"^cardflip",restrict:"A",link:function(a,b,c,d){var e;c.$observe("cardToggle",function(a){a||(a="click"),e&&b.off(e,d.toggle),e=a,b.on(a,d.toggle)})}}}]).directive("cardHeader",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-header" ng-transclude></div>'}}]).directive("cardBody",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-body" ng-transclude></div>'}}]).directive("cardFooter",[function(){return{require:["^cardBack","^cardFront"],restrict:"E",replace:!0,transclude:!0,template:'<div class="card-footer" ng-transclude></div>'}}])}(window,window.angular),angular.module("OxApp").controller("GridCtrl",["$scope","$routeParams","NotificationAPI","$location","$modal","Stage",function(a,b,c,d,e,f){a.jobs=[],a.stages={},a.rowPosition=0,a.maxCol=0;var g=12;a.createModal=function(){e.open({templateUrl:"createStageModal.html",controller:m,resolve:{stages:function(){return a.stages}}})},a.getRows=function(a){return new Array(a)},a.getCols=function(a){return new Array(a)},a.getJobInGrid=function(b,c){for(var d=0;d<a.jobs.length;d++)if(a.jobs[d].rowPosition==b&&a.jobs[d].colPosition==c)return a.jobs[d];return null};var h=function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c].colPosition;d>b&&(b=d)}return d},i=function(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];return null},j=function(b,c,d){var e=c.next;if(null!=e){var f=c;f.rowPosition=a.rowPosition,f.colPosition=d,a.jobs.push(f),d++;for(var g=0;g<e.length;g++){var h=i(b,e[g]);0!=g&&a.rowPosition++,j(b,h,d)}}},k=function(b){a.stages=b.data,j(b.data,b.data[0],0),a.maxCol=h(a.jobs),a.colDivision=Math.floor(g/(a.maxCol+1))},l=function(a){console.log("Error: "+a)};a.edit=function(){},f.getStages(b.projectId,k,l);var m=["$scope","$modalInstance","stages",function(a,d,e){a.stages=e;var g=function(){c.showNotification("Se ha creado el stage con exito.")};a.addStage=function(a){f.setStage(b.projectId,a,g,l)},a.close=function(){d.dismiss("cancel")}}]}]);